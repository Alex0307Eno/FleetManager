<script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<div id="app">
    <div class="toolbar">
        <!-- 隱藏的檔案輸入 -->
        <input type="file"
               id="cpcFile"
               ref="cpcFileInput"
               accept=".csv"
               style="display:none"
               @@change ="importCpc" />

        <!-- 點按鈕時會自動觸發檔案選擇 -->
        <button class="btn btn-primary" @@click ="selectFile">
            匯入中油
        </button>
    </div>
</div>

<script>
    const { createApp, ref } = Vue;

    createApp({
      setup() {
        const cpcFileInput = ref(null);

        function selectFile() {
          cpcFileInput.value.click(); // 觸發檔案選擇
        }

        async function importCpc(e) {
          const file = e.target.files?.[0];
          if (!file) return;

          const fd = new FormData();
          fd.append('file', file);

          try {
            const res = await axios.post('/api/fuel/import', fd, {
              headers: { 'Content-Type': 'multipart/form-data' }
            });
            alert(`匯入完成：新增 ${res.data.imported}，重複 ${res.data.duplicated}，失敗 ${res.data.failed}`);
          } catch (err) {
            alert('匯入失敗');
          } finally {
            e.target.value = ''; // 重置 input，避免同一檔案再選一次沒觸發
          }
        }

        return { cpcFileInput, selectFile, importCpc };
      }
    }).mount('#app');
</script>
