
<script src="/js/pagination.js"></script>

<div data-pagination-setup></div>

<script id="tpl-pagination" type="text/x-template">
    <div class="pagination" style="display:flex;align-items:center;gap:12px;flex-wrap:wrap">
      <button class="btn"
              @@click="to(modelValue - 1)"
              :disabled="modelValue <= 1">上一頁</button>

      <span>
        第 {{ modelValue }} / {{ totalPages }} 頁 （共 {{ total }} 筆）
      </span>

      <button class="btn"
              @@click="to(modelValue + 1)"
              :disabled="modelValue >= totalPages">下一頁</button>

      <!-- 可選：快速跳頁 -->
      <label style="margin-left:8px;">
        跳到
        <input type="number" min="1" :max="totalPages"
               :value="modelValue"
               @@change="jump($event.target.value)"
               style="width:72px;margin:0 6px;">
        頁
      </label>
    </div>
</script>

<script>
    (function(){
      if (window.__PaginationRegistered) return;
      window.__PaginationRegistered = true;

      const Pagination = {
        name: 'pagination',
        // v-model 綁在 modelValue（Vue 3 標準）
        props: {
          modelValue: { type: Number, required: true },
          pageSize:   { type: Number, default: 10 },
          total:      { type: Number, required: true }
        },
        emits: ['update:modelValue'],
        computed: {
          totalPages(){
            const t = Math.ceil((this.total || 0) / (this.pageSize || 10));
            return t > 0 ? t : 1;
          }
        },
        methods: {
          to(p){
            const n = Number(p);
            if (!Number.isFinite(n)) return;
            if (n < 1 || n > this.totalPages) return;
            this.$emit('update:modelValue', n);
          },
          jump(v){
            const n = parseInt(v, 10);
            if (!Number.isFinite(n)) return;
            this.to(n);
          }
        },
        template: '#tpl-pagination'
      };

      // 暴露給每頁的 createApp 註冊使用
      window.Pagination = Pagination;
    })();
</script>
